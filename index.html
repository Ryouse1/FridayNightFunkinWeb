<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Friday Night Funkin'</title>
	<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="theme-color" content="#000000">
	<link rel="shortcut icon" type="image/png" href="./favicon.png">
	<script>
		window.addEventListener("touchmove", function(event) { event.preventDefault(); }, { capture: false, passive: false });
		if (typeof window.devicePixelRatio !== "undefined" && window.devicePixelRatio > 2) {
			var meta = document.getElementById("viewport");
			meta.setAttribute("content", "width=device-width, initial-scale=" + (2 / window.devicePixelRatio) + ", user-scalable=no");
		}
	</script>
	<style>
		html, body { 
			margin: 0; 
			padding: 0; 
			height: 100%; 
			overflow: hidden;
			-webkit-tap-highlight-color: transparent;
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			user-select: none;
		}
		#openfl-content { 
			background: #000; 
			width: 100%; 
			height: 100%;
			position: fixed;
			top: 0;
			left: 0;
		}
		canvas {
			display: block;
			margin: 0 auto;
			max-width: 100%;
			max-height: 100%;
			image-rendering: -webkit-optimize-contrast;
			image-rendering: crisp-edges;
		}
		@font-face {
			font-family: 'Pixel Arial 11 Bold';
			src: url('assets/fonts/pixel.otf') format('opentype');
			font-weight: normal;
			font-style: normal;
			font-display: swap;
		}
		@font-face {
			font-family: 'VCR OSD Mono';
			src: url('assets/fonts/vcr.ttf') format('truetype');
			font-weight: normal;
			font-style: normal;
			font-display: swap;
		}
		@font-face {
			font-family: 'Nokia Cellphone FC Small';
			src: url('flixel/fonts/nokiafc22.ttf') format('truetype');
			font-weight: normal;
			font-style: normal;
			font-display: swap;
		}
		@font-face {
			font-family: 'Monsterrat';
			src: url('flixel/fonts/monsterrat.ttf') format('truetype');
			font-weight: normal;
			font-style: normal;
			font-display: swap;
		}
		#loading {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: #000;
			display: flex;
			justify-content: center;
			align-items: center;
			color: #fff;
			font-family: Arial, sans-serif;
			z-index: 9999;
		}
		/* モバイル用エディタ呼び出しボタン（最小限） */
		#editor-btn {
			position: fixed;
			top: 5px;
			left: 5px;
			padding: 8px 12px;
			background: rgba(0, 0, 0, 0.4);
			color: rgba(255, 255, 255, 0.7);
			border: 1px solid rgba(255, 255, 255, 0.3);
			border-radius: 4px;
			font-family: 'VCR OSD Mono', sans-serif;
			font-size: 12px;
			z-index: 1000;
			cursor: pointer;
			display: none;
			touch-action: manipulation;
		}
		#editor-btn:active {
			background: rgba(255, 255, 255, 0.3);
		}
	</style>
</head>
<body>
	<noscript>This webpage makes extensive use of JavaScript. Please enable JavaScript in your web browser to view this page.</noscript>
	<div id="loading">Loading...</div>
	<div id="editor-btn">EDITOR (E)</div>
	<div id="openfl-content"></div>
	<script src="./PsychEngine.js" defer></script>
	<script>
		function pressKey(keyCode) {
			const options = {
				keyCode: keyCode,
				which: keyCode,
				bubbles: true,
				cancelable: true
			};
			const down = new KeyboardEvent('keydown', options);
			const up = new KeyboardEvent('keyup', options);
			window.dispatchEvent(down);
			setTimeout(() => window.dispatchEvent(up), 50);
			
			// 一部のブラウザ/エンジン向けにcanvasにも直接送る
			const canvas = document.querySelector('canvas');
			if (canvas) {
				canvas.dispatchEvent(new KeyboardEvent('keydown', options));
				setTimeout(() => canvas.dispatchEvent(new KeyboardEvent('keyup', options)), 50);
			}
		}

		window.addEventListener('load', function() {
			document.getElementById('loading').style.display = 'none';
			lime.embed("PsychEngine", "openfl-content", 1280, 720, { parameters: {} });
			
			const editorBtn = document.getElementById('editor-btn');
			const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth <= 800;
			
			if (isMobile) {
				editorBtn.style.display = 'block';
				editorBtn.addEventListener('touchstart', function(e) {
					e.preventDefault();
					pressKey(69); // E key
				});
			}
		});
	</script>
</body>
</html>
